http:
  routers:

    traefik-dashboard:
      rule: "Host(`traefik.a3jm.com`)"
      service: api@internal
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # Wazuh dashboard (siem/wazuh/wazuh-docker/single-node → host port 7443)
    wazuh-dashboard:
      rule: "Host(`wazuh.a3jm.com`)"
      service: wazuh
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # Portainer (portainer-server/ → host port 9443)
    portainer-dashboard:
      rule: "Host(`portainer.a3jm.com`)"
      service: portainer
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

    # VM backend at app.a3jm.com/new (takes precedence over app for /new)
    app-vm-new:
      rule: "Host(`app.a3jm.com`) && PathPrefix(`/new`)"
      service: myvm
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt
      priority: 100

    # Docker app at app.a3jm.com (defined in dynamic section)
    app:
      rule: "Host(`app.a3jm.com`)"
      service: app
      entryPoints:
        - websecure
      tls:
        certResolver: letsencrypt

  services:
    app:
      loadBalancer:
        servers:
          - url: "http://app:3000"

    myvm:
      loadBalancer:
        servers:
          - url: "http://147.93.57.34:4000"

    # Wazuh dashboard: siem/wazuh/wazuh-docker/single-node (wazuh.dashboard exposes 7443:5601)
    wazuh:
      loadBalancer:
        servers:
          - url: "https://host.docker.internal:7443"
        serversTransport: insecureTransport

    # Portainer: same stack, container port 9443 (HTTPS)
    portainer:
      loadBalancer:
        servers:
          - url: "https://portainer:9443"
        serversTransport: insecureTransport

  serversTransports:
    insecureTransport:
      insecureSkipVerify: true